<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculator</title>
    <link rel="stylesheet" href="./styles.css">
</head>
<body>
    <div id="display"></div>
    <div id="operatorPad">
        <button id="add">+</button>
        <button id="subtract">-</button>
        <button id="multiply">*</button>
        <button id="divide">/</button>
    </div>
    <div id="numPad">
        <button id="num1">1</button>
        <button id="num2">2</button>
        <button id="num3">3</button>
        <button id="num4">4</button>
        <button id="num5">5</button>
        <button id="num6">6</button>
        <button id="num7">7</button>
        <button id="num8">8</button>
        <button id="num9">9</button>
        <button id="equals">=</button>
        <button id="num0">0</button>
        <button id="clear">C</button>
    </div>

    <script>
        

        const display = document.querySelector("#display")
        const operatorPad = document.querySelector("#operatorPad")
        const numPad = document.querySelector("#numPad")

        let a = 0
        let b = 0
        let operator
        let operatorPressed = false
        let toClear = false
        let result
        
        operatorPad.addEventListener("click", (e) => {
            if (e.target.id === "operatorPad" || toClear) return;
            if (operatorPressed) {
                console.log(`a: ${a} operator: ${operator} b: ${b}`)
                a = operate(a, operator, b)
                b = 0
                console.log(`a: ${a} operator: ${operator} b: ${b}`)
            }
            switch (e.target.id) {
                case "add":
                    display.textContent += "+"
                    operator = "+"
                    break
                case "subtract":
                    display.textContent += "-"
                    operator = "-"
                    break
                case "multiply":
                    display.textContent += "*"
                    operator = "*"
                    break
                case "divide":
                    display.textContent += "/"
                    operator = "/"
                    break
            }
            operatorPressed = true
            toClear = true
        })

        numPad.addEventListener("click", (e) => {
            if (e.target.id === "numPad") return;
            const idToDigit = {
                num0: "0",
                num1: "1",
                num2: "2",
                num3: "3",
                num4: "4",
                num5: "5",
                num6: "6",
                num7: "7",
                num8: "8",
                num9: "9",
                equals: "equals",
                clear: "clear",
            };
            const digit = idToDigit[e.target.id]
            
            if (digit === "clear") {
                a = 0
                b = 0
                operator = ""
                operatorPressed = false
                toClear = false
                result = 0
                display.textContent = ""
            } else {
                if (toClear) {
                    if (digit === "equals") {
                        console.log("tried to press equals after pressing an operator")
                    } else {
                        display.textContent = "" + digit
                        b += digit
                        toClear = false
                    }
                } else if (operatorPressed) {
                    if (digit === "equals") {
                        console.log(`a: ${a} operator: ${operator} b: ${b}`)
                        result = operate(a, operator, b)
                        a = result
                        b = 0
                        display.textContent = result
                        operatorPressed = false
                    } else {
                        b += digit
                        display.textContent += digit
                    }
                } else {
                    if (digit === "equals") {
                        console.log("tried to press equals without an operator")
                    } else {
                        a += digit
                        display.textContent += digit
                    }
                }
            }

        })

        document.addEventListener("keydown", (e) => {
            const validKeys = {
                1: "num1",
                2: "num2",
                3: "num3",
                4: "num4",
                5: "num5",
                6: "num6",
                7: "num7",
                8: "num8",
                9: "num9",
                0: "num0",
                "+": "add",
                "-": "subtract",
                "*": "multiply",
                "/": "divide",
                "=": "equals",
                Backspace: "clear",
            }
            if (validKeys.hasOwnProperty(e.key)) {
                document.querySelector(`#${validKeys[e.key]}`).click();
            }
        })


        function add(a, b) {
            return parseInt(a) + parseInt(b)
        }
        function subtract(a, b) {
            return parseInt(a) - parseInt(b)
        }
        function multiply(a, b) {
            return parseInt(a) * parseInt(b)
        }
        function divide(a, b) {
            return parseInt(a) / parseInt(b)
        }

        function operate(a, operator, b) {
            if (!b || !operator) {
                return a
            } else if (operator === "+") {
                return add(a, b)
            } else if (operator === "-") {
                return subtract(a, b)
            } else if (operator === "*") {
                return multiply(a, b)
            } else if (operator === "/") {
                if (b == 0) {
                    return 0
                } else {
                    return divide(a, b)
                }
                
            } else {
                console.log("Invalid operator")
            }
        }
    </script>

</body>
</html>